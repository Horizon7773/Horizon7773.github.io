<!doctype html>
<html lang="ko">

<head>
    <meta charset="utf-8" />
    <title>주식 반등 시그널 AI분석</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root{
          --bg:#0b0e13; --panel:#0f141c; --panel-2:#131a24; --border:#1e2734;
          --muted:#9aacbd; --text:#eef2f7; --pri:#6b7cff;
          --ok:#00c389; --bad:#ff5a7a;
          --up:#ff5a7a;     /* 상승: 빨강 */
          --down:#2ea1ff;   /* 하락: 파랑 */
        }
        *{box-sizing:border-box}
        body{background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Arial;padding:24px}
        .wrap{max-width:1000px;margin:0 auto}
        
        /* 타이틀바 */
        .titlebar{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
        h1{font-size:26px;margin:0;position:relative;letter-spacing:.2px}
        .chip.ai{font-size:13px;padding:6px 10px;border-radius:999px;background:rgba(0,195,137,.14);border:1px solid rgba(0,195,137,.28);box-shadow:inset 0 0 0 1px rgba(255,255,255,.04)}
        
        /* 구분선 */
        h1::after{
          content:"";position:absolute;left:0;right:0;bottom:-10px;height:1px;
          background:linear-gradient(90deg,transparent,#2e3b54 20%,#2e3b54 80%,transparent);opacity:.6;
        }
        
        .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:10px 0}
        .lbl{color:var(--muted);min-width:76px}
        .inp,select{
          flex:1;min-width:220px;padding:10px 12px;border-radius:10px;border:1px solid var(--border);
          /*background:linear-gradient(180deg,#0d1218,#0b1015);color:var(--text);*/
          box-shadow:inset 0 0 0 1px rgba(255,255,255,.02)
        }
        .inp:focus,select:focus{outline:none;border-color:#34425a;box-shadow:0 0 0 4px rgba(107,124,255,.12), inset 0 0 0 1px rgba(255,255,255,.04)}
        .btn{
          padding:10px 14px;border:0;border-radius:10px;background:linear-gradient(180deg,#6b7cff,#5366ff);color:#fff;
          box-shadow:0 10px 22px rgba(107,124,255,.25), inset 0 0 0 1px rgba(255,255,255,.12);cursor:pointer
        }
        .status{margin:6px 0 12px;color:var(--muted);font-size:14px}
        
        /* 카드 */
        .card{
          background: radial-gradient(1200px 400px at -10% -30%,rgba(107,124,255,.16),transparent 50%),
                      radial-gradient(800px 400px at 110% -30%,rgba(0,195,137,.12),transparent 50%), var(--panel);
          border:1px solid var(--border);border-radius:18px;box-shadow:0 20px 50px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.03);overflow:hidden
        }
        .card-hd{display:flex;justify-content:space-between;align-items:flex-end;border-bottom:1px solid rgba(255,255,255,.05);padding-bottom:14px;margin-bottom:14px}
        .title{font-size:20px;font-weight:700}
        .code{color:var(--muted);font-size:13px;margin-top:2px}
        .price .now{font-size:22px;font-weight:800;letter-spacing:.2px}
        .price .chg{font-size:13px;margin-top:4px;color:var(--muted)}
        .price .chg.up{color:var(--up)}
        .price .chg.down{color:var(--down)}
        
        /* 신호 박스 */
        .signal{
          border-radius:12px;padding:14px;margin:10px 0;background:linear-gradient(135deg,rgba(255,255,255,.03),rgba(255,255,255,.01));
          border:1px solid var(--border);position:relative;box-shadow:0 14px 34px rgba(0,0,0,.28), inset 0 0 0 1px rgba(255,255,255,.03)
        }
        .signal.buy{background:linear-gradient(135deg,rgba(0,195,137,.18),rgba(0,195,137,.06));border-color:#0f6c57}
        .signal.sell{background:linear-gradient(135deg,rgba(255,90,122,.18),rgba(255,90,122,.06));border-color:#7a2638}
        .signal.neutral{background:linear-gradient(135deg,rgba(107,124,255,.14),rgba(107,124,255,.05));border-color:#2c3461}
        .sig-badge{display:inline-block;background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.06);padding:3px 10px;border-radius:999px;font-size:12px}
        .sig-title{font-size:18px;margin:6px 0 4px}
        .sig-desc{color:#c9d6e3;font-size:14px}
        .sig-cta{position:absolute;right:12px;top:12px}
        
        /* 지표 카드 */
        .grid{display:grid;grid-template-columns:repeat(4,minmax(160px,1fr));gap:10px;margin:12px 0}
        .ind{
          background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));
          border:1px solid var(--border);border-radius:12px;padding:12px;box-shadow:inset 0 0 0 1px rgba(255,255,255,.02)
        }
        .ind-name{color:#a8b4c3;text-transform:uppercase;letter-spacing:.4px}
        .ind-val{font-weight:800;font-size:22px;margin-top:4px}
        .ind-tag{font-size:12px;margin-top:6px;display:inline-block;padding:2px 8px;border-radius:999px;background:#1f2a3b;border:1px solid #2a3550}
        
        /* 추천 구간 카드 */
        .reco{/*display:grid;grid-template-columns:repeat(2,minmax(220px,1fr));gap:10px;*/margin:4px 0 6px}
        .reco-card{
          border:1px solid var(--border);background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));
          border-radius:12px;padding:12px
        }
        .reco-card.buy{box-shadow:inset 0 0 0 1px rgba(0,195,137,.10)}
        .reco-card.sell{box-shadow:inset 0 0 0 1px rgba(255,90,122,.10)}
        .reco-ttl{font-weight:700;margin-bottom:6px;display:flex;gap:8px;align-items:center}
        .badge{font-size:12px;padding:2px 8px;border-radius:999px;background:rgba(0,195,137,.12);border:1px solid rgba(0,195,137,.28)}
        .reco-range{font-size:18px;font-weight:800;letter-spacing:.2px}
        .reco-sub{margin-top:6px;color:#c9d6e3;font-size:13px}
        
        /* 차트 */
        .chart{position:relative;border-radius:12px;overflow:hidden;background:#0e1318;border:1px solid #1c2430;padding:10px;margin:10px 0;box-shadow:0 12px 28px rgba(0,0,0,.3), inset 0 0 0 1px rgba(255,255,255,.03)}
        .chart::before{
          content:"";position:absolute;inset:10px;border-radius:10px;
          background:repeating-linear-gradient(to right,#16202d 0 1px,transparent 1px 24px),
                     repeating-linear-gradient(to bottom,#16202d 0 1px,transparent 1px 24px);
          z-index:0;pointer-events:none;opacity:.75
        }
        .chart canvas{position:relative;z-index:1}
        .note{color:#a8b4c3;font-size:13px;margin-top:8px}
        
        /* 모달 */
        .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.0);display:none;align-items:flex-end;justify-content:center;z-index:9999;}
		#md{background: linear-gradient(180deg,#6b7cff,#5366ff); width: 85% !important;color: #FFF; border-radius: 6px;}
		.modal-ft{text-align:right;margin-right:10px;}
		#mClose{color:#5366ff;background:#FFF}
    </style>

    <style>
        /* 탭 버튼 스타일 */
        .tab-menu { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
        .tab-btn { 
            padding: 10px 15px; cursor: pointer; border: none; background: #eee; color: #3498db;
            border-radius: 5px; font-weight: bold; transition: 0.3s;
        }
        .tab-btn.active { background: #3498db; color: white; }

        /* 컨텐츠 영역 스타일 */
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* 그리드 레이아웃 */
        .grid-wrapper { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 15px; }
        .select-container { background: white; padding: 5px; border-radius: 8px; border: 1px solid #ddd; }
        label { font-weight: bold; font-size: 13px; color: #333; display: block; margin-bottom: 5px; }
        
        select { 
            width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc; 
            background: white; cursor: pointer;
        }
        
        #log-panel { margin-top: 30px; padding: 15px; background: #333; color: #00ff00; border-radius: 5px; height: 100px; overflow-y: auto; font-family: monospace; }
		
		.divider {
			width: 100%;       /* 가로 꽉 채우기 */
			height: 1px;       /* 선 두께 */
			/*background-color: #ddd;*/ /* 선 색상 (연한 회색) */
			margin: 10px 0;    /* 위아래 5px, 좌우 0 여백 */
		  }		
		  
		/* 로딩 애니메이션 스타일 */
        #loading {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 200px; font-weight: bold; color: #3498db;
        }
        .spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid #3498db;
            border-radius: 50%; width: 30px; height: 30px;
            animation: spin 1s linear infinite; margin-bottom: 10px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(3600deg); } }	  
    </style>
</head>

<body>
    <div class="wrap">
        <div class="titlebar">
            <h3>주식 매수 시그널 분석</h3>
            <div class="chip ai">AI 분석 ✅</div>
        </div>

        <div style="display:none;">
            <!-- 섹터/종목 선택 -->
            <div class="row">
                <span class="lbl">섹터</span>
                <select id="selSector">
                    <option value="">선택 (반도체/2차전지/바이오)</option>
                    <option value="semicon">반도체</option>
                    <option value="battery">2차전지</option>
                    <option value="bio">바이오</option>
                </select>
                <select id="selStock" disabled>
                    <option value="">종목 선택</option>
                </select>
                <button class="btn" id="btnLoad">섹터 불러오기</button>
            </div>

            <!-- 코드 직접 입력 -->
            <div class="row">
                <span class="lbl">종목코드</span>
                <input id="ticker" class="inp" placeholder="예: 005930" />
                <button id="btnGo" class="btn">분석하기</button>
            </div>
        </div>
		
		<div id="status" class="status">준비됨</div>		

        <div class="row">
            <select id="selectMine" onchange="this.size=1; this.blur();" onfocus="this.size=5;">
                <option value="">관심종목 & 주요ETF</option>
				<option value="009150">삼성전기</option>
				<option value="487230">KODEX 미국AI전력핵심인프라</option>
				<option value="379800">KODEX 미국S&P500</option>
				<option value="069500">KODEX 200</option>
				<option value="396500">TIGER 반도체TOP10</option>
				<option value="310970">TIGER MSCI Korea TR</option>
				<option value="466920">SOL 조선TOP3플러스</option>
				<option value="161510">PLUS 고배당주</option>
				<option value="487240">KODEX AI전력핵심설비</option>
				<option value="445290">KODEX 로봇액티브</option>
				<option value="091180">KODEX 자동차</option>
				<option value="091170">KODEX 은행</option>
				<option value="228790">TIGER 화장품</option>
				<option value="462900">KoAct 바이오헬스케어액티브</option>
				<option value="160580">TIGER 구리실물</option>
				<option value="411060">ACE KRX금현물</option>	
            </select>
        </div>
		
		<div class="divider" style="margin-bottom:20px;"></div>		

        <!-- TAB -->
        <div class="tab-menu">
            <div class="tab-btn active" onclick="openTab(event, 'alpha-tab')">가나다순</div>
            <div class="tab-btn " onclick="openTab(event, 'sector-tab')">섹터별</div>
        </div>

        <div id="alpha-tab" class="tab-content active">
			<div id="abcWrap"></div>
        </div>
        <div id="sector-tab" class="tab-content">
            <div id="sectorWrap"></div>
        </div>

        

        <div id="card" class="card" style="display:none">
            <div class="card-hd">
                <div>
                    <div class="title" id="cName">-</div>
                    <div class="code" id="cCode">-</div>
                </div>
                <div class="price">
                    <div class="now" id="cClose">-</div>
                    <div class="chg" id="cChg">-</div>
                </div>
            </div>

            <div class="signal neutral" id="sigBox" data-action="brief" title="클릭하면 브리핑을 봅니다">
                <div class="sig-badge" id="sigBadge">중립</div>
                <div class="sig-title" id="sigTitle">관망</div>
                <div class="sig-desc" id="sigDesc">-</div>
                <div class="sig-cta">
                    <button class="btn" id="btnBrief" data-action="brief">브리핑 보기</button>
                </div>
            </div>

            <div class="grid">
                <div class="ind">
                    <div class="ind-name">RSI(14)</div>
                    <div class="ind-val" id="vRSI">-</div>
                    <div class="ind-tag" id="tRSI">-</div>
                </div>
                <div class="ind">
                    <div class="ind-name">MFI(14)</div>
                    <div class="ind-val" id="vMFI">-</div>
                    <div class="ind-tag" id="tMFI">-</div>
                </div>
                <div class="ind">
                    <div class="ind-name">채널 위치</div>
                    <div class="ind-val" id="vCH">-</div>
                    <div class="ind-tag" id="tCH">-</div>
                </div>
                <div class="ind">
                    <div class="ind-name">거래량 변화</div>
                    <div class="ind-val" id="vVR">-</div>
                    <div class="ind-tag" id="tVR">-</div>
                </div>
            </div>

            <!-- AI 추천 구간 카드 -->
            <div class="reco">
                <div class="reco-card buy">
                    <div class="reco-ttl">추천 매수구간 <span class="badge">쿨라매기 셋업</span></div>
                    <div class="reco-range" id="aiBuyRange">-</div>
                    <div class="reco-sub" id="aiBuyNote">
                        하단 채널 <b>20~35%</b>에서 <b>RSI 35↑</b>·<b>MFI 40↑</b> 혹은 단기 턴업 & 완만한 거래량 증가 시 분할 매수.
                    </div>
                </div>
            </div>
            <div class="reco">
                <div class="reco-card sell">
                    <div class="reco-ttl">추천 매도구간</div>
                    <div class="reco-range" id="aiSellRange">-</div>
                    <div class="reco-sub" id="aiSellNote">
                        상단 채널 <b>80~90%</b> 근접 + <b>RSI 65↓</b>·<b>MFI 75↓</b> 또는 모멘텀 둔화 시 분할 청산.
                    </div>
                </div>
            </div>

            <div class="chart">
                <canvas id="cv" height="260"></canvas>
            </div>
            <div class="note" id="note">-</div>
        </div>
    </div>

    <!-- 브리핑 모달 -->
    <div class="modal-backdrop" id="mb" style="display:none">
        <div class="modal" id="md">
            <div class="modal-hd">
                <div class="modal-ttl" id="mTitle">브리핑</div>
            </div>
            <div class="modal-bd">
                <div class="kv" id="mChips"></div>
                <div class="summary" id="mSummary"></div>
                <ul id="mList"></ul>
                <div class="note" id="mRisk"></div>
            </div>
            <div class="modal-ft">
                <button class="btn" id="mClose">닫기</button>			
            </div>
        </div>
    </div>

	<div id="loading">
        <div class="spinner"></div>
        <span>데이터를 불러오는 중입니다...</span>
    </div>

    <script>
        /* ========= 설정 ========= */
        const GAS_API = "https://script.google.com/macros/s/AKfycbyA0cHEugC7xiWCQefd71baiMZ-QaHnvB6TaDbOGb13zxkac9byReUcLWl0cjt3Ztii/exec";
        
        /* ========= 유틸 ========= */
        const $ = s => document.querySelector(s);
        const fmt = n => (n==null?'-':Number(n).toLocaleString());
        const pct = x => (x>0?`+${x.toFixed(2)}%`:`${x.toFixed(2)}%`);
        
        /* My Code */
        var selectedCode = "";
        var selectedName = "";
        
        $('#selectMine').addEventListener('change', (e)=>{
        	const code = e.target.value;
        	if (code) $('#ticker').value = code;
        	var target = document.getElementById("selectMine");	
        	selectedCode = $('#selectMine').value;
        	selectedName = target.options[target.selectedIndex].text;
        	if(code != ""){
        		analyze(true); 
        	}
        });
        
        
        
        /* JSONP (CORS 회피) */
        function jsonp(url){
          return new Promise((resolve, reject)=>{
            const cb = 'cb_' + Math.random().toString(36).slice(2);
            window[cb] = (data)=>{ resolve(data); delete window[cb]; s.remove(); };
            const s = document.createElement('script');
            s.src = url + (url.includes('?')?'&':'?') + 'callback=' + cb;
            s.onerror = ()=>{ delete window[cb]; s.remove(); reject(new Error('JSONP failed')); };
            document.body.appendChild(s);
          });
        }
        
        /* ========= 섹터/종목 ========= */
        let SECTORS = null, LAST = null;
        
        async function loadSectors(){
          $('#status').textContent = '섹터 목록 불러오는 중…';
          const data = await jsonp(`${GAS_API}?list=sectors`);
          SECTORS = data.sectors || null;
          $('#status').textContent = SECTORS ? '섹터 준비 완료' : '섹터 로드 실패';
        }
        function populateStocks(){
          const sel = $('#selSector').value;
          const target = $('#selStock');
          target.innerHTML = '<option value="">종목 선택</option>';
          target.disabled = !SECTORS || !SECTORS[sel];
          if (!SECTORS || !SECTORS[sel]) return;
          for (const x of SECTORS[sel]) {
            const opt = document.createElement('option');
            opt.value = x.code;
            opt.textContent = `${x.name} (${x.code})`;
            target.appendChild(opt);
          }
        }
        $('#selStock').addEventListener('change', (e)=>{
          const code = e.target.value;
          if (code) $('#ticker').value = code;
        });
        
        /* ========= 데이터 & 지표 ========= */
        async function fetchOHLC(code, count=60){
          const data = await jsonp(`${GAS_API}?ticker=${encodeURIComponent(code)}&count=${count}`);
          if(!data || !data.ohlc || !data.ohlc.length) throw new Error('데이터 없음');
          return data.ohlc.sort((a,b)=> new Date(a.date) - new Date(b.date));
        }
        
        function calcIndicators(rows){
          const n = rows.length;
          const close = rows.map(r=>r.close);
          const high  = rows.map(r=>r.high);
          const low   = rows.map(r=>r.low);
          const vol   = rows.map(r=>r.volume);
        
          /* RSI(14) */
          const diff  = close.map((v,i)=> i? v-close[i-1]:0);
          const up    = diff.map(x=> Math.max(x,0));
          const dn    = diff.map(x=> Math.max(-x,0));
          const roll=14;
          const avg=(arr,i,w)=>{ const s=Math.max(0,i-w+1); const sl=arr.slice(s,i+1); if(sl.length<w) return null; return sl.reduce((a,b)=>a+b,0)/w; };
        
          const rsiArr = close.map((_,i)=>{
            const ag=avg(up,i,roll), al=avg(dn,i,roll);
            if(ag==null||al==null) return null;
            const rs = al===0 ? 100 : ag/al;
            return 100 - (100/(1+rs));
          });
        
          /* MFI(14) */
          const tp = rows.map(r=> (r.high+r.low+r.close)/3);
          const rmf= tp.map((v,i)=> v*rows[i].volume);
          const pmf=[], nmf=[];
          for(let i=1;i<tp.length;i++){
            if(tp[i]>tp[i-1]) { pmf.push(rmf[i]); nmf.push(0); }
            else if(tp[i]<tp[i-1]) { pmf.push(0); nmf.push(rmf[i]); }
            else { pmf.push(0); nmf.push(0); }
          }
          const mfiArr = close.map((_,i)=>{
            if(i<roll) return null;
            const p=pmf.slice(Math.max(0,i-roll),i).reduce((a,b)=>a+b,0);
            const n=nmf.slice(Math.max(0,i-roll),i).reduce((a,b)=>a+b,0);
            if(p===0&&n===0) return 50;
            const mr = n===0?100:p/n; return 100-(100/(1+mr));
          });
        
          /* 회귀채널(중심선 ±2σ) */
          const xs=[...close.keys()];
          const sum=a=>a.reduce((x,y)=>x+y,0);
          const sX=sum(xs), sY=sum(close), sXY=sum(xs.map((x,i)=>x*close[i])), sXX=sum(xs.map(x=>x*x));
          const slope=(n*sXY-sX*sY)/(n*sXX-sX*sX);
          const intercept=(sY-slope*sX)/n;
          const reg=xs.map(x=>intercept+slope*x);
          const std=Math.sqrt(sum(close.map((v,i)=>(v-reg[i])**2))/n);
        
          const upperArr = reg.map(v=>v+2*std);
          const lowerArr = reg.map(v=>v-2*std);
          const midArr   = reg.slice();
        
          /* 채널 내 위치(%) */
          const chPos = close.map((c,i)=>{
            const up=upperArr[i], lo=lowerArr[i]; const rng=up-lo;
            return Math.max(0,Math.min(100, 100*(c-lo)/rng ));
          });
        
          /* 거래량 변화(최근 5 vs 그 이전 5) */
          const last5=vol.slice(-5).reduce((a,b)=>a+b,0)/Math.max(1,vol.slice(-5).length);
          const prev5=vol.slice(-10,-5).reduce((a,b)=>a+b,0)/Math.max(1,vol.slice(-10,-5).length);
          const volumeRatio = prev5?Math.round(last5/prev5*100):100;
        
          return {
            rsi: Number(rsiArr[n-1]?.toFixed(1)),
            mfi: Number(mfiArr[n-1]?.toFixed(1)),
            channelPos: Number(chPos[n-1]?.toFixed(1)),
            volumeRatio,
            slope, intercept, std, reg,
            upper: upperArr[n-1], lower: lowerArr[n-1], mid: midArr[n-1],
            lastClose: close[n-1],
            series: { rsiArr, mfiArr, chPos, upperArr, lowerArr, midArr, close, high, low }
          };
        }
        
        /* ========= 신호 판단(여러 개) ========= */
        function detectSignals(ind){
          const { rsiArr, mfiArr, chPos, close, high, low, upperArr, lowerArr } = ind.series;
        
          const signals = [];
          const minGap = 5;
          let lastIdx = -Infinity;
        
          const crossUp  = (arr, i, lvl) => arr[i-1]!=null && arr[i]!=null && arr[i-1] <= lvl && arr[i] >  lvl;
          const crossDn  = (arr, i, lvl) => arr[i-1]!=null && arr[i]!=null && arr[i-1] >= lvl && arr[i] <  lvl;
        
          for (let i = 2; i < close.length; i++){
            const rsi = rsiArr[i], mfi = mfiArr[i], ch = chPos[i];
            if (rsi==null || mfi==null || ch==null) continue;
            if (i - lastIdx < minGap) continue;
        
            // 하단/상단 근접 판정
            const nearLower = (ch <= 30) || (close[i] <= lowerArr[i] * 1.02);
            const nearUpper = (ch >= 80) || (close[i] >= upperArr[i] * 0.98);
        
            // 단기 모멘텀
            const turnUp   = close[i] > close[i-1] && rsiArr[i] > rsiArr[i-1];
            const turnDown = close[i] < close[i-1] && rsiArr[i] < rsiArr[i-1];
        
            const buyCond  = nearLower && ( crossUp(rsiArr,i,35) || crossUp(mfiArr,i,40) || turnUp );
            const sellCond = nearUpper && ( crossDn(rsiArr,i,65) || crossDn(mfiArr,i,75) || turnDown );
        
            if (buyCond){
              signals.push({ i, type:'buy',  price: low[i]  * 0.997 });
              lastIdx = i;
            } else if (sellCond){
              signals.push({ i, type:'sell', price: high[i] * 1.003 });
              lastIdx = i;
            }
          }
          return signals;
        }
        
        /* ========= 단일 신호(요약용) ========= */
        function judgeSignal({rsi,mfi,channelPos,volumeRatio}){
          let type='neutral', title='관망', desc='뚜렷한 신호 없음.';
          const nearLower = channelPos != null && channelPos <= 30;
          const rsiBullish = rsi != null && rsi >= 30 && rsi <= 45;
          const mfiBullish = mfi != null && mfi >= 35 && mfi <= 55;
        
          if (nearLower && (rsiBullish || mfiBullish || volumeRatio>150)){
            type='buy'; title='하단권 반등 시그널'; desc='하단 채널 근처에서 턴업. 분할 매수 관찰/진입.';
            return {type,title,desc};
          }
          if(channelPos>80 && rsi>65 && mfi>75){
            type='sell'; title='단기 과열/저항'; desc='상단 채널 과열권. 분할 청산/리스크 관리.';
            return {type,title,desc};
          }
          return {type,title,desc};
        }
        
        /* ========= 브리핑 & 추천구간 계산 ========= */
        function buildBriefing(rows, ind, signal, meta){
          const lows  = rows.slice(-10).map(r=>r.low);
          const highs = rows.slice(-10).map(r=>r.high);
          const swLow  = Math.min(...lows);
          const swHigh = Math.max(...highs);
        
          const c  = ind.lastClose, lower = ind.lower, upper = ind.upper, mid = ind.mid;
          const name = meta.name || '', code = meta.code || '';
        
          const trendUp   = ind.slope > 0;
          const nearLower = ind.channelPos <= 20;
          const nearUpper = ind.channelPos >= 80;
          const rsiLow    = ind.rsi != null && ind.rsi < 35;
          const rsiHigh   = ind.rsi != null && ind.rsi > 65;
          const mfiLow    = ind.mfi != null && ind.mfi < 40;
          const mfiHigh   = ind.mfi != null && ind.mfi > 75;
          const volStrong = ind.volumeRatio >= 150;
        
          let stance = '관망', stanceTag = '관망';
          if (nearLower && (rsiLow || mfiLow)) {
            stance = volStrong ? '분할 매수 유효 (수급 확인됨)' : '분할 매수 관찰 (수급 확인 필요)';
            stanceTag = volStrong ? '분할 매수' : '매수 관찰';
          } else if (nearUpper && (rsiHigh || mfiHigh)) {
            stance = '차익 실현/리스크 축소 권고';
            stanceTag = '차익 실현';
          } else if (trendUp && ind.channelPos < 50 && volStrong) {
            stance = '추세 우상향·눌림 매수 유효';
            stanceTag = '눌림 매수';
          }
        
          // 추천 가격대
          const entryBuyLow  = Math.round((lower*0.6 + mid*0.4));
          const entryBuyHigh = Math.round((lower*0.2 + mid*0.8));
          const entrySellLow = Math.round((mid*1.03));
          const entrySellHigh= Math.round(upper);
        
          const stopBuy  = Math.round(Math.min(swLow, lower * 0.99));
          const tpBuy    = Math.round(Math.min(upper, c*1.06));
          const stopSell = Math.round(Math.max(swHigh, upper * 1.01));
          const tpSell   = Math.round(Math.max(lower, c*0.94));
        
          const rrBuy = ((tpBuy - c) / Math.max(1, c - stopBuy)).toFixed(2);
          const rrSell= ((c - tpSell) / Math.max(1, stopSell - c)).toFixed(2);
        
          const chips = [
            `· RSI ${ind.rsi ?? '-'}`,
            `· MFI ${ind.mfi ?? '-'}`,
            `· 채널 ${ind.channelPos}%`,
            `· 거래량 ${ind.volumeRatio}%`,
            `· 스탠스 ${stanceTag}`
          ];
        
          const summary =
            `· 현재가 <span class="hl">${c.toLocaleString()}원</span><br/>` +
            `   - 회귀채널 <span class="hl">${Math.round(ind.channelPos)}%</span>위치<br/>` +
            `   - 하단 ${Math.round(lower).toLocaleString()}원<br/>` +
			`   - 중심 ${Math.round(mid).toLocaleString()}원<br/>` +
			`   - 상단 ${Math.round(upper).toLocaleString()}원<br/>` +
            `· RSI <span class="${(ind.rsi<35)?'ok':(ind.rsi>65)?'bad':'hl'}">${ind.rsi ?? '-'}</span><br/>` +
            `· MFI <span class="${(ind.mfi<40)?'ok':(ind.mfi>75)?'bad':'hl'}">${ind.mfi ?? '-'}</span><br/>` +
            `· 거래량 변화 <span class="${volStrong?'ok':'hl'}">${ind.volumeRatio}%</span><br/>` +
            `<br/><span style="font-size:20px;font-weight:700;padding-left:10px;">▶ 결론: <span class="${stanceTag.includes('매수')?'ok':stanceTag.includes('차익')?'bad':'hl'}">${stance}</span></span>.`;

        
          let items = [], risk = '', title = `[${name||code}] ${stanceTag} 전략`;
          if (stanceTag.includes('매수')) {
            items = [
              `진입(분할): ${entryBuyLow.toLocaleString()}원 ~ ${entryBuyHigh.toLocaleString()}원`,
              `손절: ${stopBuy.toLocaleString()}원`,
              `목표: ${tpBuy.toLocaleString()}원`,
              `기대 RR: ${rrBuy}배`,
              `체크: 중심선(${Math.round(ind.mid).toLocaleString()}원) 지지 + 거래량 동반`
            ];
            risk = `뉴스/갭 변동성 주의. 과매수 진입 시 속도 조절.`;
          } else if (stanceTag === '차익 실현') {
            items = [
              `보유 물량: ${entrySellLow.toLocaleString()}원 이상 분할 청산`,
              `신규 숏(데모): ${entrySellLow.toLocaleString()}원 ~ ${entrySellHigh.toLocaleString()}원`,
              `손절: ${stopSell.toLocaleString()}원`,
              `목표: ${tpSell.toLocaleString()}원`,
              `체크: 거래량 둔화·과열 해소`
            ];
            risk = `과열 해소 구간 변동성 큼. 청산은 분할로.`;
          } else {
            title = `[${name||code}] 관망`;
            items = [
              `중심선(${Math.round(ind.mid).toLocaleString()}원) 기준 방향 확인`,
              `하단 채널 반등 + 거래량 동반 시 매수, 상단/과열 시 일부 청산`,
              `우상향이면 눌림(채널 20~35%)에서만 제한적 진입`
            ];
            risk = `관망 구간: 잦은 진입보다 확률 높은 세팅까지 대기 권장.`;
          }
        
          return { title, chips, items, risk, summary, stanceTag,
                   entryBuyLow, entryBuyHigh, entrySellLow, entrySellHigh,
                   tpBuy, tpSell, stopBuy, stopSell };
        }
        
        /* ========= 캔버스 유틸 ========= */
        function drawArrow(ctx, x, y, dir='up', color='#00c389'){
          ctx.save();
          ctx.translate(x, y);
          ctx.beginPath();
          if(dir==='up'){
            ctx.moveTo(0,-8); ctx.lineTo(7,8); ctx.lineTo(-7,8);
          }else{ // down
            ctx.moveTo(0,8); ctx.lineTo(7,-8); ctx.lineTo(-7,-8);
          }
          ctx.closePath();
          ctx.fillStyle = color;
          ctx.shadowColor = color;
          ctx.shadowBlur = 8;
          ctx.fill();
          ctx.restore();
        }
        function drawBand(ctx, yTop, yBot, color='rgba(0,195,137,.10)', stroke='rgba(0,195,137,.45)'){
          ctx.save();
          ctx.fillStyle = color;
          ctx.strokeStyle = stroke;
          ctx.lineWidth = 1;
          ctx.beginPath();
          ctx.rect(0, yTop, ctx.canvas.width, Math.max(1, yBot - yTop));
          ctx.fill();
          ctx.stroke();
          ctx.restore();
        }
        /* 둥근 가격 라벨(배경+텍스트) */
        function drawPriceTag(ctx, x, y, text, bg='rgba(0,0,0,.6)', fg='#e8eef8', pad=6){
          ctx.save();
          ctx.font = '12px system-ui, -apple-system, Segoe UI, Arial';
          const w = ctx.measureText(text).width + pad*2;
          const h = 18;
          const rx = 8;
          const tx = x - w/2;
          const ty = y - h/2;
        
          // rounded rect
          ctx.beginPath();
          ctx.moveTo(tx+rx, ty);
          ctx.arcTo(tx+w, ty,   tx+w, ty+h, rx);
          ctx.arcTo(tx+w, ty+h, tx,   ty+h, rx);
          ctx.arcTo(tx,   ty+h, tx,   ty,   rx);
          ctx.arcTo(tx,   ty,   tx+w, ty,   rx);
          ctx.closePath();
          ctx.fillStyle = bg;
          ctx.fill();
        
          ctx.fillStyle = fg;
          ctx.fillText(text, tx+pad, ty + 12);
          ctx.restore();
        }
        
        function render(rows, ind, code, name){
          $('#card').style.display='block';
          $('#cName').textContent = name || '—';
          $('#cCode').textContent = code;
        
          const last=rows[rows.length-1], prev=rows[rows.length-2]||last;
          const chg=last.close-prev.close, rate=prev.close?chg/prev.close*100:0;
          $('#cClose').textContent=fmt(last.close)+'원';
        
          // ▲ 빨강(상승), ▼ 파랑(하락)
          const chgEl = $('#cChg');
          const isUp = chg >= 0;
          chgEl.textContent = `${isUp?'▲':'▼'} ${fmt(Math.abs(chg))} (${pct(rate)})`;
          chgEl.classList.toggle('up', isUp);
          chgEl.classList.toggle('down', !isUp);
        
          $('#vRSI').textContent=ind.rsi ?? '-';
          $('#tRSI').textContent=ind.rsi<30?'과매도':ind.rsi>70?'과매수':'중립';
          $('#vMFI').textContent=ind.mfi ?? '-';
          $('#tMFI').textContent=ind.mfi<40?'매수우위':ind.mfi>80?'매도우위':'균형';
          $('#vCH').textContent=(ind.channelPos??'-')+'%';
          $('#tCH').textContent=ind.channelPos<30?'하단':ind.channelPos>70?'상단':'중간';
          $('#vVR').textContent=(ind.volumeRatio??'-')+'%';
          $('#tVR').textContent=ind.volumeRatio>150?'급증':'평균';
        
          const sig=judgeSignal(ind);
          const box=$('#sigBox'); box.className='signal '+(sig.type||'neutral');
          $('#sigBadge').textContent=sig.type==='buy'?'매수 신호':(sig.type==='sell'?'매도 신호':'중립');
          $('#sigTitle').textContent=sig.title;
          $('#sigDesc').textContent=sig.desc;
          $('#note').textContent=`데이터: ${rows[0].date} ~ ${rows[rows.length-1].date} | HTS/MTS 실시간과 차이날 수 있음`;
        
          const brief = buildBriefing(rows, ind, sig, { code, name });
          $('#aiBuyRange').textContent  = `${brief.entryBuyLow.toLocaleString()} ~ ${brief.entryBuyHigh.toLocaleString()}원 (TP ${brief.tpBuy.toLocaleString()} / SL ${brief.stopBuy.toLocaleString()})`;
          $('#aiSellRange').textContent = `${brief.entrySellLow.toLocaleString()} ~ ${brief.entrySellHigh.toLocaleString()}원 (TP ${brief.tpSell.toLocaleString()} / SL ${brief.stopSell.toLocaleString()})`;
        
          LAST = { rows, ind, sig, code, name, brief };
        
          // ===== 차트 =====
          const cv=$('#cv'), ctx=cv.getContext('2d');
          const W=cv.clientWidth||900; cv.width=W; const H=cv.height;
          ctx.clearRect(0,0,W,H);
        
          const pad=30, w=W-pad*2, h=H-pad*2;
          const min=Math.min(...rows.map(r=>r.low));
          const max=Math.max(...rows.map(r=>r.high));
          const range=max-min||1;
          const xAt = i => pad + i/(rows.length-1)*w;
          const yAtPrice = p => pad + (1-(p-min)/range)*h;
        
          // 추천구간 밴드
          const yBuyTop = yAtPrice(brief.entryBuyHigh), yBuyBot = yAtPrice(brief.entryBuyLow);
          drawBand(ctx, yBuyTop, yBuyBot, 'rgba(0,195,137,.10)', 'rgba(0,195,137,.35)');
          const ySellTop = yAtPrice(brief.entrySellHigh), ySellBot = yAtPrice(brief.entrySellLow);
          drawBand(ctx, ySellTop, ySellBot, 'rgba(255,90,122,.10)', 'rgba(255,90,122,.35)');
        
          // 채널(shaded)
          ctx.fillStyle='rgba(107,124,255,0.12)';
          ctx.beginPath();
          rows.forEach((r,i)=>{
            const x=xAt(i);
            const y=yAtPrice(ind.series.upperArr[i]);
            i?ctx.lineTo(x,y):ctx.moveTo(x,y);
          });
          for(let i=rows.length-1;i>=0;i--){
            const x=xAt(i);
            const y=yAtPrice(ind.series.lowerArr[i]);
            ctx.lineTo(x,y);
          }
          ctx.closePath(); ctx.fill();
        
          // 중앙선
          ctx.strokeStyle='#7f8ab5'; ctx.setLineDash([5,5]);
          ctx.beginPath();
          rows.forEach((r,i)=>{
            const x=xAt(i);
            const y=yAtPrice(ind.series.midArr[i]);
            i?ctx.lineTo(x,y):ctx.moveTo(x,y);
          });
          ctx.stroke(); ctx.setLineDash([]);
        
          // 종가 라인
          ctx.strokeStyle='#6b7cff'; ctx.lineWidth=2;
          ctx.beginPath();
          rows.forEach((r,i)=>{
            const x=xAt(i);
            const y=yAtPrice(r.close);
            i?ctx.lineTo(x,y):ctx.moveTo(x,y);
          });
          ctx.stroke();
        
          // === 신호 화살표 + 가격 라벨 ===
          const signals = detectSignals(ind);
          signals.forEach(s=>{
            const x = xAt(s.i);
            const y = yAtPrice(s.price);
        
            if(s.type==='buy'){
              drawArrow(ctx, x, y, 'up',  '#00c389');
              drawPriceTag(ctx, x, y-18, `매수 ${Math.round(s.price).toLocaleString()}원`, 'rgba(0,195,137,.25)', '#eafff7');
            }
            if(s.type==='sell'){
              drawArrow(ctx, x, y, 'down','#ff5a7a');
              drawPriceTag(ctx, x, y+18, `매도 ${Math.round(s.price).toLocaleString()}원`, 'rgba(255,90,122,.28)', '#fff0f3');
            }
          });
        }
        
        /* ========= 모달 ========= */
        function openBrief(){
          if(!LAST) return;
          const { rows, ind, sig, code, name } = LAST;
          const b = buildBriefing(rows, ind, sig, { code, name });
        
          $('#mTitle').textContent = b.title;
        
          const chips = $('#mChips'); chips.innerHTML='';
          b.chips.forEach(t=>{ const el=document.createElement('div'); el.className='chip'; el.textContent=t; chips.appendChild(el); });
        
          $('#mSummary').innerHTML = b.summary;
        
          const ul=$('#mList'); ul.innerHTML='';
          b.items.forEach(t=>{ const li=document.createElement('li'); li.textContent=t; ul.appendChild(li); });
          $('#mRisk').textContent = b.risk;
          //$('#mCta').href = `https://www.tradingview.com/`;
        
          const mb=$('#mb'), md=$('#md');
          mb.style.display='flex';
          setTimeout(()=>md.classList.add('show'),10);
        }
        function closeBrief(){
          const mb=$('#mb'), md=$('#md');
          md.classList.remove('show');
          setTimeout(()=>mb.style.display='none',150);
        }
        document.addEventListener('click', (e)=>{
          const t = e.target.closest('[data-action="brief"]');
          if (t) openBrief();
        });
        $('#mClose').addEventListener('click', closeBrief);
        $('#mb').addEventListener('click', (e)=>{ if(e.target.id==='mb') closeBrief(); });
        
        /* ========= 실행 ========= */
        async function analyze(mine){
          try{
            $('#status').textContent='불러오는 중…';
			loading.style.display = '';
            const code=$('#ticker').value.trim();
            if(!code) throw new Error('종목코드를 입력하세요 (예: 005930)');
            const rows=await fetchOHLC(code,60);
            const ind =calcIndicators(rows);
        
            const sel = $('#selStock');
            const name = (sel.value===code && sel.selectedOptions[0]) ? sel.selectedOptions[0].textContent.replace(/\s*\(\d+\)\s*$/,'') : '';
            render(rows,ind,code,name);
            $('#status').textContent='완료';
        	
        	if(mine == true){
        		if(selectedCode != "" && selectedName != ""){
        			$('#cName').textContent = selectedName;
        		}	
        	}
			
          }catch(e){
            $('#status').textContent='오류: '+e.message;
            $('#card').style.display='none';
          }

			loading.style.display = 'none';
			card.scrollIntoView({behavior : 'smooth'});
        }

        $('#btnGo').addEventListener('click', analyze);
        $('#ticker').addEventListener('keydown', e=>{ if(e.key==='Enter') analyze(); });
        $('#btnLoad').addEventListener('click', loadSectors);
        $('#selSector').addEventListener('change', populateStocks);
        
        
        // 기본값
        $('#ticker').value='005930';
    </script>


    <script>
        // 1. JSON 데이터를 변수로 직접 선언
        const sectorData = {"반도체":[{"stock":"삼성전자","code":"005930"},{"stock":"SK하이닉스","code":"000660"},{"stock":"한미반도체","code":"042700"},{"stock":"리노공업","code":"058470"},{"stock":"원익IPS","code":"240810"},{"stock":"이오테크닉스","code":"039030"},{"stock":"DB하이텍","code":"000990"},{"stock":"HPSP","code":"403870"},{"stock":"솔브레인","code":"357780"},{"stock":"동진쎄미켐","code":"005290"}],"MSCI":[{"stock":"삼성전자","code":"005930"},{"stock":"SK하이닉스","code":"000660"},{"stock":"삼성전자우","code":"005935"},{"stock":"현대차","code":"005380"},{"stock":"KB금융","code":"105560"},{"stock":"SK스퀘어","code":"402340"},{"stock":"신한지주","code":"055550"},{"stock":"두산에너빌리티","code":"034020"},{"stock":"한화에어로스페이스","code":"012450"},{"stock":"기아","code":"000270"},{"stock":"NAVER","code":"035420"},{"stock":"셀트리온","code":"068270"},{"stock":"하나금융지주","code":"086790"},{"stock":"POSCO홀딩스","code":"005490"},{"stock":"현대모비스","code":"012330"},{"stock":"삼성물산","code":"028260"},{"stock":"삼성SDI","code":"006400"},{"stock":"우리금융지주","code":"316140"},{"stock":"HD현대일렉트릭","code":"267260"},{"stock":"삼성바이오로직스","code":"207940"},{"stock":"HD현대중공업","code":"329180"},{"stock":"삼성중공업","code":"010140"},{"stock":"한화오션","code":"042660"},{"stock":"LG에너지솔루션","code":"373220"},{"stock":"카카오","code":"035720"},{"stock":"HD한국조선해양","code":"009540"},{"stock":"에코프로","code":"086520"},{"stock":"삼성전기","code":"009150"},{"stock":"한국전력","code":"015760"},{"stock":"KT&G","code":"033780"},{"stock":"현대로템","code":"064350"},{"stock":"삼성화재","code":"000810"},{"stock":"삼성생명","code":"032830"},{"stock":"LG화학","code":"051910"},{"stock":"알테오젠","code":"196170"},{"stock":"효성중공업","code":"298040"},{"stock":"한국항공우주","code":"047810"},{"stock":"SK","code":"034730"},{"stock":"LG전자","code":"066570"},{"stock":"HD현대","code":"267250"},{"stock":"메리츠금융지주","code":"138040"},{"stock":"에코프로비엠","code":"247540"},{"stock":"미래에셋증권","code":"006800"},{"stock":"현대글로비스","code":"086280"},{"stock":"현대차2우B","code":"005387"},{"stock":"LS ELECTRIC","code":"010120"},{"stock":"한미반도체","code":"042700"},{"stock":"한국금융지주","code":"071050"},{"stock":"LG","code":"003550"},{"stock":"하이브","code":"352820"},{"stock":"한화시스템","code":"272210"},{"stock":"포스코퓨처엠","code":"003670"},{"stock":"DB손해보험","code":"005830"},{"stock":"SK텔레콤","code":"017670"},{"stock":"SK이노베이션","code":"096770"},{"stock":"삼성에스디에스","code":"018260"},{"stock":"크래프톤","code":"259960"},{"stock":"기업은행","code":"024110"},{"stock":"에이피알","code":"278470"},{"stock":"HLB","code":"028300"},{"stock":"두산","code":"000150"},{"stock":"유한양행","code":"000100"},{"stock":"현대차우","code":"005385"},{"stock":"LIG넥스원","code":"079550"},{"stock":"한국타이어앤테크놀로지","code":"161390"},{"stock":"HMM","code":"011200"},{"stock":"삼양식품","code":"003230"},{"stock":"대한항공","code":"003490"},{"stock":"카카오뱅크","code":"323410"},{"stock":"S-Oil","code":"010950"},{"stock":"코웨이","code":"021240"},{"stock":"아모레퍼시픽","code":"090430"},{"stock":"NH투자증권","code":"005940"},{"stock":"LG디스플레이","code":"034220"},{"stock":"포스코인터내셔널","code":"047050"},{"stock":"SK바이오팜","code":"326030"},{"stock":"LG유플러스","code":"032640"},{"stock":"두산밥캣","code":"241560"},{"stock":"HD현대마린솔루션","code":"443060"},{"stock":"한진칼","code":"180640"},{"stock":"LG생활건강","code":"051900"}],"조선":[{"stock":"삼성중공업","code":"010140"},{"stock":"한화오션","code":"042660"},{"stock":"HD현대중공업","code":"329180"},{"stock":"HD한국조선해양","code":"009540"},{"stock":"한화엔진","code":"082740"},{"stock":"HD현대마린엔진","code":"071670"},{"stock":"HD현대마린솔루션","code":"443060"},{"stock":"동성화인텍","code":"033530"},{"stock":"한국카본","code":"017960"},{"stock":"대한조선","code":"439260"},{"stock":"세진중공업","code":"075580"},{"stock":"STX엔진","code":"077970"}],"2차전지":[{"stock":"삼성SDI","code":"006400"},{"stock":"LG에너지솔루션","code":"373220"},{"stock":"POSCO홀딩스","code":"005490"},{"stock":"에코프로비엠","code":"247540"},{"stock":"에코프로","code":"086520"},{"stock":"LG화학","code":"051910"},{"stock":"포스코퓨처엠","code":"003670"},{"stock":"SK이노베이션","code":"096770"},{"stock":"엘앤에프","code":"066970"},{"stock":"엔켐","code":"348370"},{"stock":"에코프로머티","code":"450080"},{"stock":"나노신소재","code":"121600"},{"stock":"SKC","code":"011790"},{"stock":"코스모신소재","code":"005070"},{"stock":"롯데에너지머티리얼즈","code":"020150"},{"stock":"피엔티","code":"137400"},{"stock":"SK아이이테크놀로지","code":"361610"},{"stock":"씨아이에스","code":"222080"},{"stock":"대주전자재료","code":"078600"},{"stock":"코스모화학","code":"005420"},{"stock":"후성","code":"093370"},{"stock":"한중엔시에스","code":"107640"},{"stock":"솔루스첨단소재","code":"336370"},{"stock":"솔브레인홀딩스","code":"036320"},{"stock":"하나기술","code":"299030"}],"방산":[{"stock":"한화에어로스페이스","code":"012450"},{"stock":"한국항공우주","code":"047810"},{"stock":"한화오션","code":"042660"},{"stock":"현대로템","code":"064350"},{"stock":"한화시스템","code":"272210"},{"stock":"LIG넥스원","code":"079550"},{"stock":"풍산","code":"103140"},{"stock":"STX엔진","code":"077970"},{"stock":"SNT다이내믹스","code":"003570"},{"stock":"엠앤씨솔루션","code":"484870"}],"AI전력":[{"stock":"LS ELECTRIC","code":"010120"},{"stock":"효성중공업","code":"298040"},{"stock":"HD현대일렉트릭","code":"267260"},{"stock":"LS","code":"006260"},{"stock":"대한전선","code":"001440"},{"stock":"산일전기","code":"062040"},{"stock":"일진전기","code":"103590"},{"stock":"가온전선","code":"000500"},{"stock":"제룡전기","code":"033100"},{"stock":"LS마린솔루션","code":"060370"},{"stock":"LS에코에너지","code":"229640"},{"stock":"대원전선","code":"006340"}],"로봇":[{"stock":"레인보우로보틱스","code":"272410"},{"stock":"로보티즈","code":"108490"},{"stock":"두산로보틱스","code":"454910"},{"stock":"에스피지","code":"058610"},{"stock":"현대오토에버","code":"307950"},{"stock":"뉴로메카","code":"348340"},{"stock":"현대차","code":"005380"},{"stock":"현대모비스","code":"012330"},{"stock":"SK하이닉스","code":"000660"},{"stock":"NAVER","code":"035420"},{"stock":"유진로봇","code":"056080"},{"stock":"LG전자","code":"066570"},{"stock":"HD현대","code":"267250"},{"stock":"클로봇","code":"466100"},{"stock":"유일로보틱스","code":"388720"},{"stock":"원익홀딩스","code":"030530"},{"stock":"큐렉소","code":"060280"},{"stock":"KT","code":"030200"},{"stock":"삼성에스디에스","code":"018260"},{"stock":"카카오","code":"035720"},{"stock":"삼현","code":"437730"},{"stock":"에스비비테크","code":"307710"},{"stock":"현대로템","code":"064350"},{"stock":"고영","code":"098460"},{"stock":"하이젠알앤엠","code":"076340"},{"stock":"제이브이엠","code":"054950"},{"stock":"엔젤로보틱스","code":"448410"},{"stock":"나우로보틱스","code":"481170"},{"stock":"LIG넥스원","code":"079550"},{"stock":"에스오에스랩","code":"464080"},{"stock":"코난테크놀로지","code":"402030"}],"자동차":[{"stock":"현대차","code":"005380"},{"stock":"기아","code":"000270"},{"stock":"현대모비스","code":"012330"},{"stock":"한국타이어앤테크놀로지","code":"161390"},{"stock":"HL만도","code":"204320"},{"stock":"현대위아","code":"011210"},{"stock":"금호타이어","code":"073240"},{"stock":"한온시스템","code":"018880"},{"stock":"에스엘","code":"005850"},{"stock":"한국앤컴퍼니","code":"000240"},{"stock":"삼현","code":"437730"},{"stock":"DN오토모티브","code":"007340"},{"stock":"세방전지","code":"004490"},{"stock":"KG모빌리티","code":"003620"},{"stock":"SNT모티브","code":"064960"},{"stock":"성우하이텍","code":"015750"},{"stock":"넥센타이어","code":"002350"},{"stock":"SNT홀딩스","code":"036530"},{"stock":"명신산업","code":"009900"},{"stock":"일진하이솔루스","code":"271940"}],"은행":[{"stock":"신한지주","code":"055550"},{"stock":"하나금융지주","code":"086790"},{"stock":"KB금융","code":"105560"},{"stock":"우리금융지주","code":"316140"},{"stock":"카카오뱅크","code":"323410"},{"stock":"기업은행","code":"024110"},{"stock":"BNK금융지주","code":"138930"},{"stock":"JB금융지주","code":"175330"},{"stock":"iM금융지주","code":"139130"},{"stock":"제주은행","code":"006220"}],"화장품":[{"stock":"달바글로벌","code":"483310"},{"stock":"에이피알","code":"278470"},{"stock":"코스맥스","code":"192820"},{"stock":"아모레퍼시픽","code":"090430"},{"stock":"한국콜마","code":"161890"},{"stock":"LG생활건강","code":"051900"},{"stock":"실리콘투","code":"257720"},{"stock":"파마리서치","code":"214450"},{"stock":"코스메카코리아","code":"241710"},{"stock":"브이티","code":"018290"},{"stock":"펌텍코리아","code":"251970"},{"stock":"아이패밀리에스씨","code":"114840"},{"stock":"제닉","code":"123330"},{"stock":"씨앤씨인터내셔널","code":"352480"},{"stock":"마녀공장","code":"439090"},{"stock":"토니모리","code":"214420"},{"stock":"클리오","code":"237880"},{"stock":"아로마티카","code":"0015N0"},{"stock":"잇츠한불","code":"226320"}],"바이오":[{"stock":"에이비엘바이오","code":"298380"},{"stock":"리가켐바이오","code":"141080"},{"stock":"에스티팜","code":"237690"},{"stock":"한미약품","code":"128940"},{"stock":"올릭스","code":"226950"},{"stock":"셀트리온","code":"068270"},{"stock":"알테오젠","code":"196170"},{"stock":"파마리서치","code":"214450"},{"stock":"씨어스테크놀로지","code":"458870"},{"stock":"에이프릴바이오","code":"397030"},{"stock":"디앤디파마텍","code":"347850"},{"stock":"알지노믹스","code":"476830"},{"stock":"넥스트바이오메디컬","code":"389650"},{"stock":"보로노이","code":"310210"},{"stock":"뉴로핏","code":"380550"},{"stock":"삼양바이오팜","code":"0120G0"},{"stock":"휴젤","code":"145020"},{"stock":"일동제약","code":"249420"},{"stock":"나이벡","code":"138610"},{"stock":"녹십자","code":"006280"},{"stock":"삼성바이오로직스","code":"207940"},{"stock":"인벤티지랩","code":"389470"},{"stock":"지투지바이오","code":"456160"},{"stock":"SK바이오팜","code":"326030"},{"stock":"프로티나","code":"468530"},{"stock":"클래시스","code":"214150"},{"stock":"삼천당제약","code":"000250"},{"stock":"로킷헬스케어","code":"376900"},{"stock":"한스바이오메드","code":"042520"},{"stock":"더블유에스아이","code":"299170"},{"stock":"원텍","code":"336570"}]};
		const abcData = {"코스피":[{"stock":"가온전선","code":"000500"},{"stock":"강원랜드","code":"035250"},{"stock":"고려아연","code":"010130"},{"stock":"교보증권","code":"030610"},{"stock":"금호석유화학","code":"011780"},{"stock":"금호타이어","code":"073240"},{"stock":"기아","code":"000270"},{"stock":"기업은행","code":"024110"},{"stock":"넷마블","code":"251270"},{"stock":"녹십자","code":"006280"},{"stock":"농심","code":"004370"},{"stock":"다우기술","code":"023590"},{"stock":"달바글로벌","code":"483310"},{"stock":"대덕전자","code":"353200"},{"stock":"대신증권","code":"003540"},{"stock":"대우건설","code":"047040"},{"stock":"대웅","code":"003090"},{"stock":"대웅제약","code":"069620"},{"stock":"대한전선","code":"001440"},{"stock":"대한항공","code":"003490"},{"stock":"더블유게임즈","code":"192080"},{"stock":"더존비즈온","code":"012510"},{"stock":"동서","code":"026960"},{"stock":"동양생명","code":"082640"},{"stock":"동원산업","code":"006040"},{"stock":"두산","code":"000150"},{"stock":"두산로보틱스","code":"454910"},{"stock":"두산밥캣","code":"241560"},{"stock":"두산에너빌리티","code":"034020"},{"stock":"두산퓨얼셀","code":"336260"},{"stock":"롯데관광개발","code":"032350"},{"stock":"롯데렌탈","code":"089860"},{"stock":"롯데리츠","code":"330590"},{"stock":"롯데쇼핑","code":"023530"},{"stock":"롯데에너지머티리얼즈","code":"020150"},{"stock":"롯데웰푸드","code":"280360"},{"stock":"롯데정밀화학","code":"004000"},{"stock":"롯데지주","code":"004990"},{"stock":"롯데칠성","code":"005300"},{"stock":"롯데케미칼","code":"011170"},{"stock":"맥쿼리인프라","code":"088350"},{"stock":"메리츠금융지주","code":"138040"},{"stock":"미래에셋생명","code":"085620"},{"stock":"미래에셋증권","code":"006800"},{"stock":"산일전기","code":"062040"},{"stock":"삼성E&A","code":"028050"},{"stock":"삼성SDI","code":"006400"},{"stock":"삼성물산","code":"028260"},{"stock":"삼성바이오로직스","code":"207940"},{"stock":"삼성생명","code":"032830"},{"stock":"삼성에스디에스","code":"018260"},{"stock":"삼성전기","code":"009150"},{"stock":"삼성전자","code":"005930"},{"stock":"삼성전자우","code":"005935"},{"stock":"삼성중공업","code":"010140"},{"stock":"삼성증권","code":"016360"},{"stock":"삼성카드","code":"029780"},{"stock":"삼성화재","code":"000810"},{"stock":"삼성화재우","code":"000815"},{"stock":"삼양식품","code":"003230"},{"stock":"세아베스틸지주","code":"001430"},{"stock":"셀트리온","code":"068270"},{"stock":"시프트업","code":"462870"},{"stock":"신세계","code":"004170"},{"stock":"신영증권","code":"001720"},{"stock":"신한지주","code":"055550"},{"stock":"씨에스윈드","code":"112610"},{"stock":"아모레퍼시픽","code":"090430"},{"stock":"아모레퍼시픽홀딩스","code":"002790"},{"stock":"아시아나항공","code":"020560"},{"stock":"에스엘","code":"005850"},{"stock":"에스원","code":"012750"},{"stock":"에이피알","code":"278470"},{"stock":"에코프로머티","code":"450080"},{"stock":"엔씨소프트","code":"036570"},{"stock":"엘앤에프","code":"066970"},{"stock":"영원무역","code":"111770"},{"stock":"영원무역홀딩스","code":"009970"},{"stock":"오뚜기","code":"007310"},{"stock":"오리온","code":"271560"},{"stock":"오리온홀딩스","code":"001800"},{"stock":"우리금융지주","code":"316140"},{"stock":"유한양행","code":"000100"},{"stock":"이마트","code":"139480"},{"stock":"이수스페셜티케미컬","code":"457190"},{"stock":"이수페타시스","code":"007660"},{"stock":"일동제약","code":"249420"},{"stock":"일진전기","code":"103590"},{"stock":"제일기획","code":"030000"},{"stock":"종근당","code":"185750"},{"stock":"지역난방공사","code":"071320"},{"stock":"카카오","code":"035720"},{"stock":"카카오뱅크","code":"323410"},{"stock":"카카오페이","code":"377300"},{"stock":"코리아써키트","code":"006810"},{"stock":"코리안리","code":"003690"},{"stock":"코스맥스","code":"192820"},{"stock":"코스모신소재","code":"005070"},{"stock":"코오롱인더","code":"120110"},{"stock":"코웨이","code":"021240"},{"stock":"크래프톤","code":"259960"},{"stock":"키움증권","code":"039490"},{"stock":"파라다이스","code":"034230"},{"stock":"팬오션","code":"028670"},{"stock":"포스코DX","code":"022100"},{"stock":"포스코인터내셔널","code":"047050"},{"stock":"포스코퓨처엠","code":"003670"},{"stock":"풍산","code":"103140"},{"stock":"하나금융지주","code":"086790"},{"stock":"하이브","code":"352820"},{"stock":"하이트진로","code":"000080"},{"stock":"한국가스공사","code":"036460"},{"stock":"한국금융지주","code":"071050"},{"stock":"한국앤컴퍼니","code":"000240"},{"stock":"한국전력","code":"015760"},{"stock":"한국카본","code":"017960"},{"stock":"한국콜마","code":"161890"},{"stock":"한국타이어앤테크놀로지","code":"161390"},{"stock":"한국항공우주","code":"047810"},{"stock":"한미반도체","code":"042700"},{"stock":"한미사이언스","code":"008930"},{"stock":"한미약품","code":"128940"},{"stock":"한솔케미칼","code":"014680"},{"stock":"한온시스템","code":"018880"},{"stock":"한올바이오파마","code":"009420"},{"stock":"한일시멘트","code":"300720"},{"stock":"한전KPS","code":"051600"},{"stock":"한전기술","code":"052690"},{"stock":"한진칼","code":"180640"},{"stock":"한화","code":"000880"},{"stock":"한화생명","code":"088350"},{"stock":"한화솔루션","code":"009830"},{"stock":"한화시스템","code":"272210"},{"stock":"한화에어로스페이스","code":"012450"},{"stock":"한화엔진","code":"082740"},{"stock":"한화오션","code":"042660"},{"stock":"한화투자증권","code":"003530"},{"stock":"현대건설","code":"000720"},{"stock":"현대글로비스","code":"086280"},{"stock":"현대로템","code":"064350"},{"stock":"현대모비스","code":"012330"},{"stock":"현대백화점","code":"069960"},{"stock":"현대엘리베이터","code":"017800"},{"stock":"현대오토에버","code":"307950"},{"stock":"현대위아","code":"011210"},{"stock":"현대제철","code":"004020"},{"stock":"현대지에프홀딩스","code":"005440"},{"stock":"현대차","code":"005380"},{"stock":"현대차2우B","code":"005387"},{"stock":"현대차우","code":"005385"},{"stock":"현대해상","code":"001450"},{"stock":"호텔신라","code":"008770"},{"stock":"효성","code":"004800"},{"stock":"효성중공업","code":"298040"},{"stock":"효성티앤씨","code":"298020"},{"stock":"BGF리테일","code":"282330"},{"stock":"BNK금융지주","code":"138930"},{"stock":"CJ","code":"001040"},{"stock":"CJ대한통운","code":"000120"},{"stock":"CJ제일제당","code":"097950"},{"stock":"DB손해보험","code":"005830"},{"stock":"DB하이텍","code":"000990"},{"stock":"DL이앤씨","code":"375500"},{"stock":"DN오토모티브","code":"007340"},{"stock":"F&F","code":"383220"},{"stock":"GS","code":"078930"},{"stock":"GS건설","code":"006360"},{"stock":"GS리테일","code":"007070"},{"stock":"HDC","code":"012630"},{"stock":"HDC현대산업개발","code":"294870"},{"stock":"HD건설기계","code":"267270"},{"stock":"HD한국조선해양","code":"009540"},{"stock":"HD현대","code":"267250"},{"stock":"HD현대마린솔루션","code":"443060"},{"stock":"HD현대마린엔진","code":"071670"},{"stock":"HD현대일렉트릭","code":"267260"},{"stock":"HD현대중공업","code":"329180"},{"stock":"HJ중공업","code":"097230"},{"stock":"HL만도","code":"204320"},{"stock":"HMM","code":"011200"},{"stock":"HS효성첨단소재","code":"298050"},{"stock":"JB금융지주","code":"175330"},{"stock":"KB금융","code":"105560"},{"stock":"KCC","code":"002380"},{"stock":"KT","code":"030200"},{"stock":"KT&G","code":"033780"},{"stock":"LG","code":"003550"},{"stock":"LG디스플레이","code":"034220"},{"stock":"LG생활건강","code":"051900"},{"stock":"LG에너지솔루션","code":"373220"},{"stock":"LG유플러스","code":"032640"},{"stock":"LG이노텍","code":"011070"},{"stock":"LG전자","code":"066570"},{"stock":"LG화학","code":"051910"},{"stock":"LIG넥스원","code":"079550"},{"stock":"LS","code":"006260"},{"stock":"LS ELECTRIC","code":"010120"},{"stock":"LS에코에너지","code":"229640"},{"stock":"LX인터내셔널","code":"001120"},{"stock":"NAVER","code":"035420"},{"stock":"NH투자증권","code":"005940"},{"stock":"OCI홀딩스","code":"010060"},{"stock":"POSCO홀딩스","code":"005490"},{"stock":"S-Oil","code":"010950"},{"stock":"SK","code":"034730"},{"stock":"SKC","code":"011790"},{"stock":"SK가스","code":"018670"},{"stock":"SK네트웍스","code":"001740"},{"stock":"SK리츠","code":"395400"},{"stock":"SK바이오사이언스","code":"302440"},{"stock":"SK바이오팜","code":"326030"},{"stock":"SK스퀘어","code":"402340"},{"stock":"SK아이이테크놀로지","code":"361610"},{"stock":"SK이노베이션","code":"096770"},{"stock":"SK케미칼","code":"285130"},{"stock":"SK텔레콤","code":"017670"},{"stock":"SK하이닉스","code":"000660"},{"stock":"SNT다이내믹스","code":"003570"},{"stock":"STX엔진","code":"077970"},{"stock":"iM금융지주","code":"139130"}],"코스닥":[{"stock":"가온칩스","code":"399720"},{"stock":"감성코퍼레이션","code":"003580"},{"stock":"고영","code":"098460"},{"stock":"그래피","code":"318060"},{"stock":"기가비스","code":"420770"},{"stock":"나노신소재","code":"121600"},{"stock":"나라스페이스테크놀로지","code":"478340"},{"stock":"네오셈","code":"253590"},{"stock":"네오위즈","code":"095660"},{"stock":"네이처셀","code":"007390"},{"stock":"넥스트바이오메디컬","code":"389650"},{"stock":"넥스틴","code":"347100"},{"stock":"넥슨게임즈","code":"225570"},{"stock":"노타","code":"486990"},{"stock":"뉴로메카","code":"348340"},{"stock":"다날","code":"064260"},{"stock":"다우데이타","code":"032190"},{"stock":"대주전자재료","code":"078600"},{"stock":"덕산네오룩스","code":"213420"},{"stock":"덕양에너젠","code":"0001A0"},{"stock":"동국제약","code":"086450"},{"stock":"동성화인텍","code":"033530"},{"stock":"동운아나텍","code":"094170"},{"stock":"동진쎄미켐","code":"005290"},{"stock":"두산테스나","code":"131970"},{"stock":"디앤디파마텍","code":"347850"},{"stock":"디어유","code":"376300"},{"stock":"레이크머티리얼즈","code":"281740"},{"stock":"레인보우로보틱스","code":"272410"},{"stock":"로보스타","code":"090360"},{"stock":"로보티즈","code":"108490"},{"stock":"로킷헬스케어","code":"376900"},{"stock":"루닛","code":"328130"},{"stock":"리가켐바이오","code":"141080"},{"stock":"리노공업","code":"058470"},{"stock":"리브스메드","code":"491000"},{"stock":"메디톡스","code":"086900"},{"stock":"메디포스트","code":"078160"},{"stock":"메지온","code":"140410"},{"stock":"미래에셋벤처투자","code":"100790"},{"stock":"미코","code":"059090"},{"stock":"보로노이","code":"310210"},{"stock":"브이엠","code":"089530"},{"stock":"브이티","code":"018290"},{"stock":"비나텍","code":"126340"},{"stock":"비에이치아이","code":"083650"},{"stock":"비츠로넥스텍","code":"488900"},{"stock":"비츠로셀","code":"082920"},{"stock":"삼천당제약","code":"000250"},{"stock":"삼표시멘트","code":"038500"},{"stock":"삼현","code":"437730"},{"stock":"샘씨엔에스","code":"252990"},{"stock":"서부T&D","code":"006730"},{"stock":"서진시스템","code":"178320"},{"stock":"선익시스템","code":"171090"},{"stock":"성광벤드","code":"014620"},{"stock":"성우하이텍","code":"015750"},{"stock":"성일하이텍","code":"365340"},{"stock":"성호전자","code":"043260"},{"stock":"세미파이브","code":"490470"},{"stock":"셀트리온제약","code":"068760"},{"stock":"솔브레인","code":"357780"},{"stock":"솔브레인홀딩스","code":"036320"},{"stock":"스튜디오드래곤","code":"253450"},{"stock":"스피어","code":"347700"},{"stock":"시노펙스","code":"025320"},{"stock":"신성델타테크","code":"065350"},{"stock":"실리콘투","code":"257720"},{"stock":"심텍","code":"222800"},{"stock":"쎄트렉아이","code":"099320"},{"stock":"쏠리드","code":"050890"},{"stock":"씨아이에스","code":"222080"},{"stock":"씨어스테크놀로지","code":"458870"},{"stock":"씨엠티엑스","code":"388210"},{"stock":"씨젠","code":"096530"},{"stock":"아난티","code":"025980"},{"stock":"아이쓰리시스템","code":"214430"},{"stock":"아이티센글로벌","code":"124500"},{"stock":"아주IB투자","code":"027360"},{"stock":"안랩","code":"053800"},{"stock":"알지노믹스","code":"476830"},{"stock":"알테오젠","code":"196170"},{"stock":"앱클론","code":"174900"},{"stock":"에스앤에스텍","code":"101490"},{"stock":"에스에프에이","code":"056190"},{"stock":"에스엠","code":"041510"},{"stock":"에스티팜","code":"237690"},{"stock":"에스피지","code":"058610"},{"stock":"에이비엘바이오","code":"298380"},{"stock":"에이치브이엠","code":"295310"},{"stock":"에이프릴바이오","code":"397030"},{"stock":"에임드바이오","code":"0009K0"},{"stock":"에코프로","code":"086520"},{"stock":"에코프로비엠","code":"247540"},{"stock":"에코프로에이치엔","code":"383310"},{"stock":"에프에스티","code":"036810"},{"stock":"엔켐","code":"348370"},{"stock":"엘앤씨바이오","code":"290650"},{"stock":"오름테라퓨틱","code":"311060"},{"stock":"오스코텍","code":"039200"},{"stock":"온코닉테라퓨틱스","code":"327070"},{"stock":"올릭스","code":"226950"},{"stock":"와이씨","code":"232140"},{"stock":"와이지엔터테인먼트","code":"122870"},{"stock":"우리기술","code":"032820"},{"stock":"우리기술투자","code":"041190"},{"stock":"원익IPS","code":"240810"},{"stock":"원익QnC","code":"074600"},{"stock":"원익홀딩스","code":"030530"},{"stock":"원텍","code":"336570"},{"stock":"위메이드","code":"112040"},{"stock":"유일로보틱스","code":"388720"},{"stock":"유진로봇","code":"056080"},{"stock":"유진테크","code":"084370"},{"stock":"이녹스첨단소재","code":"272290"},{"stock":"이뮨온시아","code":"424870"},{"stock":"이엔에프테크놀로지","code":"102710"},{"stock":"이오테크닉스","code":"039030"},{"stock":"인벤티지랩","code":"389470"},{"stock":"인카금융서비스","code":"211050"},{"stock":"인텔리안테크","code":"189300"},{"stock":"인투셀","code":"287840"},{"stock":"제룡전기","code":"033100"},{"stock":"제우스","code":"079370"},{"stock":"제이앤티씨","code":"204270"},{"stock":"제이에스링크","code":"127120"},{"stock":"제주반도체","code":"080220"},{"stock":"젬백스","code":"082270"},{"stock":"주성엔지니어링","code":"036930"},{"stock":"지노믹트리","code":"228230"},{"stock":"지아이이노베이션","code":"358570"},{"stock":"지엔씨에너지","code":"119850"},{"stock":"지투지바이오","code":"456160"},{"stock":"차바이오텍","code":"085660"},{"stock":"천보","code":"278280"},{"stock":"카카오게임즈","code":"293490"},{"stock":"카페24","code":"042000"},{"stock":"케어젠","code":"214370"},{"stock":"케이아이엔엑스","code":"093320"},{"stock":"케이엠더블유","code":"032500"},{"stock":"코나아이","code":"052400"},{"stock":"코미코","code":"183300"},{"stock":"코미팜","code":"041960"},{"stock":"코스메카코리아","code":"241710"},{"stock":"코오롱생명과학","code":"102940"},{"stock":"코오롱티슈진","code":"950160"},{"stock":"큐렉소","code":"060280"},{"stock":"큐로셀","code":"372320"},{"stock":"큐리언트","code":"115180"},{"stock":"큐리옥스바이오시스템즈","code":"445680"},{"stock":"클래시스","code":"214150"},{"stock":"클로봇","code":"466100"},{"stock":"태광","code":"023160"},{"stock":"태성","code":"323280"},{"stock":"태웅","code":"044490"},{"stock":"테스","code":"095610"},{"stock":"테크윙","code":"089030"},{"stock":"토모큐브","code":"475480"},{"stock":"티씨케이","code":"064760"},{"stock":"티에스이","code":"131290"},{"stock":"티엘비","code":"356860"},{"stock":"파두","code":"440110"},{"stock":"파마리서치","code":"214450"},{"stock":"파크시스템스","code":"140860"},{"stock":"펄어비스","code":"263750"},{"stock":"펌텍코리아","code":"251970"},{"stock":"펩트론","code":"087010"},{"stock":"포스코엠텍","code":"009520"},{"stock":"프로텍","code":"053610"},{"stock":"프로티나","code":"468530"},{"stock":"피에스케이","code":"319660"},{"stock":"피에스케이홀딩스","code":"031980"},{"stock":"피엔티","code":"137400"},{"stock":"필옵틱스","code":"161580"},{"stock":"하나마이크론","code":"067310"},{"stock":"하나머티리얼즈","code":"166090"},{"stock":"하림지주","code":"003380"},{"stock":"하이젠알앤엠","code":"076340"},{"stock":"한글과컴퓨터","code":"030520"},{"stock":"한라캐스트","code":"125490"},{"stock":"한스바이오메드","code":"042520"},{"stock":"현대무벡스","code":"311690"},{"stock":"현대바이오","code":"048410"},{"stock":"현대힘스","code":"460930"},{"stock":"휴림로봇","code":"090710"},{"stock":"휴온스글로벌","code":"084110"},{"stock":"휴젤","code":"145020"},{"stock":"CJ ENM","code":"035760"},{"stock":"HEM파마","code":"376270"},{"stock":"HK이노엔","code":"195940"},{"stock":"HLB","code":"028300"},{"stock":"HPSP","code":"403870"},{"stock":"ISC","code":"095340"},{"stock":"JYP Ent.","code":"035900"},{"stock":"LS마린솔루션","code":"060370"},{"stock":"LS머트리얼즈","code":"417200"},{"stock":"NHN KCP","code":"060250"},{"stock":"RFHIC","code":"218410"},{"stock":"SFA반도체","code":"036540"},{"stock":"SOOP","code":"067160"}]};

		// 2. 탭 전환 함수
        function openTab(event, tabId) {
            const contents = document.getElementsByClassName("tab-content");
            for (let content of contents) content.classList.remove("active");

            const btns = document.getElementsByClassName("tab-btn");
            for (let btn of btns) btn.classList.remove("active");

            document.getElementById(tabId).classList.add("active");
            event.currentTarget.classList.add("active");
        }
		
         //2. Select Box에 Option을 채워주는 함수
        function fillSelectOptions(jsonData, key, targetId) {

            const selectBox = document.getElementById(targetId);
            if (!selectBox || !jsonData[key]) return;

            // 기본 옵션 생성
            selectBox.innerHTML = `<option value="">-- ${key.replace('_', ' ')} 선택 --</option>`;
            
            // 데이터 순회하며 옵션 추가
            jsonData[key].forEach(item => {
                const option = document.createElement('option');
                option.value = item.code;
                //option.textContent = `${item.stock} (${item.code})`; // 종목명과 코드를 함께 표시
				option.textContent = `${item.stock}`;
                selectBox.appendChild(option);
            });
		}
		
        /**
         * 3. Select 태그를 동적으로 생성하고 초기화하는 메인 함수
         */
        function initSelectors(wrap, jsonData) {
            const wrapper = document.getElementById(wrap);
			
            // sectorData의 모든 Key를 순회하며 UI 생성
            Object.keys(jsonData).forEach(sector => {
                // 1) 컨테이너 생성
                const container = document.createElement('div');
                container.className = 'select-container row';
		
                // 2) 라벨 생성		
                const label = document.createElement('label');
                label.textContent = '['+sector.replace(/_/g, ' ')+']';
				// 개행(br) 추가
                const br = document.createElement('br');			
				
                // 3) Select 태그 생성					
                const select = document.createElement('select');
                const selectId = `select-${sector}`;
                select.id = selectId;
				// --- 요청하신 UI 이벤트 속성 추가 ---
                select.setAttribute('onfocus', 'this.size=5;');
                select.setAttribute('onchange', 'this.size=1; this.blur();');				
				// --- 데이터 추출을 위한 이벤트 리스너 추가 ---
				select.addEventListener('change', handleStockChange);

				// 4) HTML 조립
                container.appendChild(select);
                wrapper.appendChild(container);

                // 5) 옵션 채우기 함수 호출
                fillSelectOptions(jsonData, sector, selectId);
            });
        }
		
		const loading = document.getElementById('loading');
		const card = document.getElementById('card');
		
		function createSelector(){
			initSelectors('sectorWrap', sectorData);
			initSelectors('abcWrap', abcData);
			loading.style.display = 'none';
			card.style.display = 'none';
		}
		

        // 페이지 로드 시 즉시 실행
        window.onload = createSelector;
		
		/**
		 * 종목 선택 시 호출되는 이벤트 핸들러
		 * @param {Event} event - change 이벤트 객체
		 */
		function handleStockChange(event) {
			loading.style.display = '';
			loading.scrollIntoView({behavior : 'smooth'});		
			card.style.display = 'none';
			
			// 1. 선택된 selectbox 요소 가져오기
			const selectElement = event.target;
			if (selectElement.selectedIndex === -1) return;			
			

			// 2. 선택된 옵션의 value (종목코드) 추출
			const selectedValue = selectElement.value;

			// 3. 선택된 옵션의 text (종목명) 추출
			// selectedIndex를 이용해 현재 선택된 option 태그의 텍스트를 가져옵니다.
			const selectedText = selectElement.options[selectElement.selectedIndex].text;

			// 4. 업종명(ID에서 추출)
			const sectorName = selectElement.id.replace('select-', '');

			// 값이 비어있지 않을 때만 로직 실행 (기본 옵션 제외)
			if (selectedValue) {
				//console.log("추출된 업종:", sectorName);
				//console.log("추출된 코드(Value):", selectedValue);
				//console.log("추출된 종목명(Text):", selectedText);
				
				$('#ticker').value = selectedValue;
				
				selectedCode = selectedValue;
				selectedName = selectedText;

				if(selectedValue != ""){
					analyze(true); 
				}
				
			}					
		}
    </script>


</body>

</html>
